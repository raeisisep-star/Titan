<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Settings</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">๐ Settings Debug Tool</h1>
        
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ุจุฑุฑุณ ูุถุนุช</h2>
            
            <button onclick="checkStatus()" class="mb-4 px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">
                โ ุจุฑุฑุณ ูุถุนุช
            </button>
            
            <pre id="status" class="bg-gray-900 p-4 rounded text-xs overflow-auto max-h-96"></pre>
        </div>
        
        <div class="bg-gray-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">ุชุณุช ุฏฺฉููโูุง ุชุจ Exchanges</h2>
            
            <div class="space-y-2 mb-4">
                <button onclick="testMEXC()" class="w-full px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded">
                    ๐ ุชุณุช ุงุชุตุงู MEXC
                </button>
                <button onclick="testMEXCAccount()" class="w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded">
                    ๐ค ุงุทูุงุนุงุช ุญุณุงุจ MEXC
                </button>
                <button onclick="testSave()" class="w-full px-4 py-2 bg-green-600 hover:bg-green-700 rounded">
                    ๐พ ุชุณุช ุฐุฎุฑู ุชูุธูุงุช
                </button>
            </div>
            
            <pre id="test-result" class="bg-gray-900 p-4 rounded text-xs overflow-auto max-h-64"></pre>
        </div>
        
        <div class="bg-yellow-900 bg-opacity-30 border border-yellow-600 rounded-lg p-4">
            <h3 class="font-bold mb-2">โ๏ธ ุฑุงูููุง:</h3>
            <ol class="text-sm space-y-1">
                <li>1. ุงู ุตูุญู ุฑุง ุฏุฑ ุชุจ ุฌุฏุฏ ุจุงุฒ ฺฉูุฏ</li>
                <li>2. ุฏุฑ ุชุจ ุฏฺฏุฑ ุจู ุตูุญู ุงุตู ุจุฑูุฏ ู Login ฺฉูุฏ</li>
                <li>3. ุจู Settings โ Exchanges ุจุฑูุฏ</li>
                <li>4. ุจุนุฏ ุจู ุงู ุตูุญู ุจุฑฺฏุฑุฏุฏ ู "ุจุฑุฑุณ ูุถุนุช" ุฑุง ุจุฒูุฏ</li>
                <li>5. ูุดฺฉูุงุช ุฑุง ุฏุฑ console ุจุจูุฏ</li>
            </ol>
        </div>
    </div>
    
    <script>
        function log(message, data = null) {
            console.log(message, data);
            const statusEl = document.getElementById('status');
            const testEl = document.getElementById('test-result');
            const targetEl = testEl.textContent ? testEl : statusEl;
            
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            targetEl.textContent += `[${timestamp}] ${message}\n`;
            
            if (data) {
                targetEl.textContent += JSON.stringify(data, null, 2) + '\n';
            }
            targetEl.textContent += '\n';
        }
        
        function checkStatus() {
            document.getElementById('status').textContent = '';
            document.getElementById('test-result').textContent = '';
            
            log('=== ุดุฑูุน ุจุฑุฑุณ ===');
            
            // Check window.unifiedSettings
            log('1. window.unifiedSettings:', window.unifiedSettings);
            if (window.unifiedSettings) {
                log('   - currentTab:', window.unifiedSettings.currentTab);
                log('   - isLoading:', window.unifiedSettings.isLoading);
                log('   - settings:', window.unifiedSettings.settings);
            }
            
            // Check window.exchangesTab
            log('2. window.exchangesTab:', window.exchangesTab);
            if (window.exchangesTab) {
                log('   - has saveSettings:', typeof window.exchangesTab.saveSettings === 'function');
                log('   - has initialize:', typeof window.exchangesTab.initialize === 'function');
                log('   - has testMEXCConnection:', typeof window.exchangesTab.testMEXCConnection === 'function');
                log('   - settings:', window.exchangesTab.settings);
            }
            
            // Check UnifiedSettingsModule
            log('3. window.UnifiedSettingsModule:', window.UnifiedSettingsModule);
            
            // Check ExchangesTab class
            log('4. ุชูุงุด ุจุฑุง ุจุงุฑฺฏุฐุงุฑ ExchangesTab...');
            try {
                const script = document.createElement('script');
                script.type = 'module';
                script.textContent = `
                    import ExchangesTab from '/static/modules/settings/tabs/exchanges-tab.js';
                    window.testExchangesTab = ExchangesTab;
                    console.log('ExchangesTab loaded:', ExchangesTab);
                `;
                document.head.appendChild(script);
                log('   - Script ุงุถุงูู ุดุฏุ console ุฑุง ุจุฑุฑุณ ฺฉูุฏ');
            } catch (error) {
                log('   - ุฎุทุง:', error.message);
            }
            
            // Check localStorage token
            const token = localStorage.getItem('titan_auth_token');
            log('5. Token ููุฌูุฏ ุงุณุช:', !!token);
            if (token) {
                log('   - Token length:', token.length);
            }
            
            // Check if settings page is open
            const settingsContent = document.getElementById('unified-settings-content');
            log('6. Settings page ุจุงุฒ ุงุณุช:', !!settingsContent);
            
            log('=== ูพุงุงู ุจุฑุฑุณ ===');
        }
        
        async function testMEXC() {
            document.getElementById('test-result').textContent = '';
            log('๐ ุชุณุช ุงุชุตุงู MEXC...');
            
            if (!window.exchangesTab) {
                log('โ window.exchangesTab ููุฌูุฏ ูุณุช!');
                log('ุฑุงูโุญู: ุจู ุตูุญู Settings โ Exchanges ุจุฑูุฏ');
                return;
            }
            
            if (typeof window.exchangesTab.testMEXCConnection !== 'function') {
                log('โ ูุชุฏ testMEXCConnection ููุฌูุฏ ูุณุช!');
                return;
            }
            
            try {
                await window.exchangesTab.testMEXCConnection();
                log('โ ุชุงุจุน ูุฑุงุฎูุงู ุดุฏ');
            } catch (error) {
                log('โ ุฎุทุง:', error.message);
            }
        }
        
        async function testMEXCAccount() {
            document.getElementById('test-result').textContent = '';
            log('๐ค ุฏุฑุงูุช ุงุทูุงุนุงุช ุญุณุงุจ MEXC...');
            
            if (!window.exchangesTab) {
                log('โ window.exchangesTab ููุฌูุฏ ูุณุช!');
                return;
            }
            
            if (typeof window.exchangesTab.getMEXCAccountInfo !== 'function') {
                log('โ ูุชุฏ getMEXCAccountInfo ููุฌูุฏ ูุณุช!');
                return;
            }
            
            try {
                await window.exchangesTab.getMEXCAccountInfo();
                log('โ ุชุงุจุน ูุฑุงุฎูุงู ุดุฏ');
            } catch (error) {
                log('โ ุฎุทุง:', error.message);
            }
        }
        
        async function testSave() {
            document.getElementById('test-result').textContent = '';
            log('๐พ ุชุณุช ุฐุฎุฑู ุชูุธูุงุช...');
            
            if (!window.unifiedSettings) {
                log('โ window.unifiedSettings ููุฌูุฏ ูุณุช!');
                return;
            }
            
            log('Tab ูุนู:', window.unifiedSettings.currentTab);
            
            if (!window.exchangesTab) {
                log('โ window.exchangesTab ููุฌูุฏ ูุณุช!');
                log('ุฑุงูโุญู: ุจู ุชุจ Exchanges ุจุฑูุฏ');
                return;
            }
            
            if (typeof window.exchangesTab.saveSettings !== 'function') {
                log('โ ูุชุฏ saveSettings ููุฌูุฏ ูุณุช!');
                log('ููุงุฑุฏ ููุฌูุฏ:', Object.keys(window.exchangesTab));
                return;
            }
            
            try {
                log('๐ค ูุฑุงุฎูุงู saveSettings...');
                const result = await window.exchangesTab.saveSettings();
                log('โ ูุชุฌู:', result);
            } catch (error) {
                log('โ ุฎุทุง:', error.message);
                log('Stack:', error.stack);
            }
        }
        
        // Auto check on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('ุตูุญู ุจุงุฑฺฏุฐุงุฑ ุดุฏ. ุจุฑุง ุจุฑุฑุณ ุฏฺฉูู ุฑุง ุจุฒูุฏ.');
            }, 1000);
        });
    </script>
</body>
</html>
