# Fail2ban jail configuration for Nginx 4xx errors
# Path: /etc/fail2ban/jail.d/nginx-4xx.local
#
# This jail monitors Nginx error logs for repeated:
# - 401 errors (authentication failures)
# - 403 errors (forbidden access attempts)
# - 429 errors (rate limit violations)

[nginx-security]
enabled = true
filter = nginx-security
logpath = /var/log/nginx/zala-error.log
          /var/log/nginx/error.log
maxretry = 15
findtime = 600
bantime = 3600
action = iptables-multiport[name=nginx-security, port="http,https", protocol=tcp]

# Ban parameters:
# - maxretry: 15 violations within findtime window
# - findtime: 600 seconds (10 minutes) window
# - bantime: 3600 seconds (1 hour) ban duration

# After 15 failed attempts (401/403/429) within 10 minutes:
# â†’ IP banned for 1 hour via iptables

# Notes:
# - Rate limiting already handles normal traffic bursts
# - This catches persistent attackers who keep retrying
# - Cloudflare Real IP extraction ensures we ban actual client IP, not CF proxy
