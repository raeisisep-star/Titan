<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artemis AI Module Test - Phase 4 Complete</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white" dir="rtl">
    <div class="container mx-auto p-8">
        <h1 class="text-4xl font-bold mb-8 text-center">
            <span class="text-6xl">🧠</span><br>
            تست کامل سیستم آرتمیس AI - فاز 4
        </h1>

        <!-- Test Results Dashboard -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="text-center">
                    <div class="text-2xl mb-2">📊</div>
                    <h3 class="text-lg font-semibold">API Tests</h3>
                    <div id="api-test-result" class="text-2xl font-bold text-yellow-400">...</div>
                </div>
            </div>
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="text-center">
                    <div class="text-2xl mb-2">🤖</div>
                    <h3 class="text-lg font-semibold">AI Agents</h3>
                    <div id="agents-test-result" class="text-2xl font-bold text-yellow-400">...</div>
                </div>
            </div>
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="text-center">
                    <div class="text-2xl mb-2">💬</div>
                    <h3 class="text-lg font-semibold">AI Chat</h3>
                    <div id="chat-test-result" class="text-2xl font-bold text-yellow-400">...</div>
                </div>
            </div>
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <div class="text-center">
                    <div class="text-2xl mb-2">🔮</div>
                    <h3 class="text-lg font-semibold">Predictions</h3>
                    <div id="predictions-test-result" class="text-2xl font-bold text-yellow-400">...</div>
                </div>
            </div>
        </div>

        <!-- Live Test Console -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-2xl font-bold mb-4">🔍 Test Console</h2>
            <div id="test-console" class="bg-gray-900 rounded p-4 h-64 overflow-y-auto font-mono text-sm"></div>
            <div class="mt-4 flex gap-4">
                <button onclick="runAllTests()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded">
                    <i class="fas fa-play mr-2"></i>Run All Tests
                </button>
                <button onclick="clearConsole()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded">
                    <i class="fas fa-trash mr-2"></i>Clear
                </button>
            </div>
        </div>

        <!-- AI Chat Test -->
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700 mb-8">
            <h2 class="text-2xl font-bold mb-4">💬 AI Chat Test</h2>
            <div id="chat-messages" class="bg-gray-900 rounded p-4 h-48 overflow-y-auto mb-4"></div>
            <div class="flex gap-2">
                <input type="text" id="chat-input" placeholder="Test message..." 
                       class="flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white">
                <button onclick="sendTestMessage()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                    Send
                </button>
            </div>
        </div>

        <!-- API Data Display -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Agents Data -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4">🤖 AI Agents Status</h2>
                <div id="agents-data" class="space-y-2"></div>
            </div>

            <!-- Predictions Data -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4">🔮 AI Predictions</h2>
                <div id="predictions-data" class="space-y-2"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        const BASE_URL = window.location.origin;
        let testCount = 0;
        let passedTests = 0;

        function log(message, type = 'info') {
            const console = document.getElementById('test-console');
            const timestamp = new Date().toLocaleTimeString();
            const color = {
                'info': 'text-blue-400',
                'success': 'text-green-400',
                'error': 'text-red-400',
                'warning': 'text-yellow-400'
            }[type];
            
            console.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        function updateTestResult(testName, status) {
            const element = document.getElementById(`${testName}-test-result`);
            if (element) {
                if (status === 'pass') {
                    element.textContent = '✅ PASS';
                    element.className = 'text-2xl font-bold text-green-400';
                    passedTests++;
                } else if (status === 'fail') {
                    element.textContent = '❌ FAIL';
                    element.className = 'text-2xl font-bold text-red-400';
                } else {
                    element.textContent = '🔄 Testing...';
                    element.className = 'text-2xl font-bold text-yellow-400';
                }
            }
        }

        async function testAPI() {
            log('🚀 Testing API connectivity...', 'info');
            updateTestResult('api', 'testing');
            
            try {
                const response = await axios.get(`${BASE_URL}/api/health`);
                if (response.data.status === 'healthy') {
                    log('✅ API Health Check: OK', 'success');
                    updateTestResult('api', 'pass');
                    return true;
                } else {
                    throw new Error('Unhealthy response');
                }
            } catch (error) {
                log(`❌ API Health Check: ${error.message}`, 'error');
                updateTestResult('api', 'fail');
                return false;
            }
        }

        async function testArtemisAgents() {
            log('🤖 Testing Artemis AI Agents...', 'info');
            updateTestResult('agents', 'testing');
            
            try {
                const response = await axios.get(`${BASE_URL}/api/artemis/agents`);
                if (response.data.success && response.data.data.length > 0) {
                    log(`✅ Found ${response.data.data.length} active AI agents`, 'success');
                    
                    // Display agents data
                    const agentsDiv = document.getElementById('agents-data');
                    agentsDiv.innerHTML = response.data.data.map(agent => `
                        <div class="bg-gray-700 rounded p-3">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <span class="text-xl mr-2">${agent.icon}</span>
                                    <span class="font-medium">${agent.name}</span>
                                </div>
                                <div class="text-right">
                                    <div class="text-green-400">${agent.confidence}%</div>
                                    <div class="text-xs text-gray-400">${agent.status}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    updateTestResult('agents', 'pass');
                    return true;
                } else {
                    throw new Error('No agents found');
                }
            } catch (error) {
                log(`❌ Artemis Agents: ${error.message}`, 'error');
                updateTestResult('agents', 'fail');
                return false;
            }
        }

        async function testArtemisChat() {
            log('💬 Testing Artemis AI Chat...', 'info');
            updateTestResult('chat', 'testing');
            
            try {
                const response = await axios.post(`${BASE_URL}/api/artemis/chat`, {
                    message: 'سلام آرتمیس، این یک تست است'
                });
                
                if (response.data.success && response.data.data.ai_response) {
                    log('✅ AI Chat response received', 'success');
                    
                    // Display chat message
                    const chatDiv = document.getElementById('chat-messages');
                    chatDiv.innerHTML += `
                        <div class="mb-2">
                            <div class="text-blue-300 text-sm">Test User:</div>
                            <div class="text-gray-300">سلام آرتمیس، این یک تست است</div>
                        </div>
                        <div class="mb-2">
                            <div class="text-purple-300 text-sm">Artemis AI:</div>
                            <div class="text-gray-300">${response.data.data.ai_response.message}</div>
                        </div>
                    `;
                    chatDiv.scrollTop = chatDiv.scrollHeight;
                    
                    updateTestResult('chat', 'pass');
                    return true;
                } else {
                    throw new Error('Invalid chat response');
                }
            } catch (error) {
                log(`❌ Artemis Chat: ${error.message}`, 'error');
                updateTestResult('chat', 'fail');
                return false;
            }
        }

        async function testArtemisPredictions() {
            log('🔮 Testing Artemis AI Predictions...', 'info');
            updateTestResult('predictions', 'testing');
            
            try {
                const response = await axios.get(`${BASE_URL}/api/artemis/predictions`);
                
                if (response.data.success && response.data.data.length > 0) {
                    log(`✅ Found ${response.data.data.length} AI predictions`, 'success');
                    
                    // Display predictions data
                    const predictionsDiv = document.getElementById('predictions-data');
                    predictionsDiv.innerHTML = response.data.data.map(pred => `
                        <div class="bg-gray-700 rounded p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-blue-300">${pred.symbol}</span>
                                <span class="text-purple-400">${pred.confidence}%</span>
                            </div>
                            <div class="text-sm text-gray-400">
                                ${pred.current_price.toLocaleString()} → ${pred.target_price.toLocaleString()}
                            </div>
                            <div class="text-xs text-gray-500">${pred.timeframe}</div>
                        </div>
                    `).join('');
                    
                    updateTestResult('predictions', 'pass');
                    return true;
                } else {
                    throw new Error('No predictions found');
                }
            } catch (error) {
                log(`❌ Artemis Predictions: ${error.message}`, 'error');
                updateTestResult('predictions', 'fail');
                return false;
            }
        }

        async function runAllTests() {
            log('🚀 Starting Artemis AI Phase 4 Complete Test Suite...', 'info');
            testCount = 0;
            passedTests = 0;
            
            // Reset all test results
            ['api', 'agents', 'chat', 'predictions'].forEach(test => {
                updateTestResult(test, 'testing');
            });

            const tests = [
                { name: 'API Connectivity', fn: testAPI },
                { name: 'AI Agents', fn: testArtemisAgents },
                { name: 'AI Chat', fn: testArtemisChat },
                { name: 'AI Predictions', fn: testArtemisPredictions }
            ];

            for (const test of tests) {
                testCount++;
                log(`🧪 Running test ${testCount}: ${test.name}`, 'info');
                await test.fn();
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay
            }

            // Final summary
            log(`\n📊 Test Summary: ${passedTests}/${testCount} tests passed`, 
                passedTests === testCount ? 'success' : 'warning');
            
            if (passedTests === testCount) {
                log('🎉 All Artemis AI Phase 4 features are working correctly!', 'success');
            } else {
                log('⚠️ Some tests failed. Please check the errors above.', 'warning');
            }
        }

        async function sendTestMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;

            const chatDiv = document.getElementById('chat-messages');
            chatDiv.innerHTML += `
                <div class="mb-2">
                    <div class="text-blue-300 text-sm">You:</div>
                    <div class="text-gray-300">${message}</div>
                </div>
            `;

            try {
                const response = await axios.post(`${BASE_URL}/api/artemis/chat`, {
                    message: message
                });

                if (response.data.success) {
                    chatDiv.innerHTML += `
                        <div class="mb-2">
                            <div class="text-purple-300 text-sm">Artemis AI:</div>
                            <div class="text-gray-300">${response.data.data.ai_response.message}</div>
                        </div>
                    `;
                }
            } catch (error) {
                chatDiv.innerHTML += `
                    <div class="mb-2 text-red-400">
                        Error: ${error.message}
                    </div>
                `;
            }

            input.value = '';
            chatDiv.scrollTop = chatDiv.scrollHeight;
        }

        function clearConsole() {
            document.getElementById('test-console').innerHTML = '';
        }

        // Auto-start tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(runAllTests, 1000);
        });

        // Enter key for chat
        document.getElementById('chat-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendTestMessage();
            }
        });
    </script>
</body>
</html>