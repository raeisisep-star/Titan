<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug AI Management Module</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">ğŸ§  Debug AI Management Module</h1>
        
        <div class="space-y-6">
            <!-- Status Container -->
            <div id="status-container" class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4">ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</h2>
                <div id="status-log" class="space-y-2 text-sm font-mono bg-black p-4 rounded max-h-60 overflow-y-auto">
                    <div class="text-green-400">Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
                </div>
            </div>
            
            <!-- Test Buttons -->
            <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4">ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒÛŒ</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="testAPIConnection()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-plug mr-2"></i>
                        ØªØ³Øª API
                    </button>
                    <button onclick="testModuleLoading()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-download mr-2"></i>
                        ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„
                    </button>
                    <button onclick="testDashboardRender()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-eye mr-2"></i>
                        ØªØ³Øª Ø±Ù†Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
                    </button>
                </div>
            </div>
            
            <!-- AI Management Container -->
            <div id="ai-management-debug" class="bg-gray-800 rounded-lg p-6 border border-gray-700">
                <h2 class="text-xl font-bold mb-4">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ AI Management</h2>
                <div id="ai-management-container" class="min-h-32">
                    <div class="bg-gray-900 rounded-lg p-6 text-center">
                        <div class="animate-spin inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mb-4"></div>
                        <p class="text-gray-300">Ø¢Ù…Ø§Ø¯Ù‡ Ø³Ø§Ø²ÛŒ...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let statusLog = [];
        
        function addStatus(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const colors = {
                info: 'text-blue-400',
                success: 'text-green-400', 
                error: 'text-red-400',
                warning: 'text-yellow-400'
            };
            
            statusLog.push({message, type, timestamp});
            const logElement = document.getElementById('status-log');
            logElement.innerHTML += `<div class="${colors[type] || 'text-gray-400'}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        async function testAPIConnection() {
            addStatus('ğŸ“¡ ØªØ³Øª Ø§ØªØµØ§Ù„ API...', 'info');
            try {
                const response = await axios.get('/api/ai-analytics/agents');
                if (response.data && response.data.agents) {
                    addStatus(`âœ… API Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚ - ${response.data.agents.length} agent loaded`, 'success');
                } else {
                    addStatus('âš ï¸ API response structure unexpected', 'warning');
                }
            } catch (error) {
                addStatus(`âŒ API Error: ${error.message}`, 'error');
            }
        }
        
        async function testModuleLoading() {
            addStatus('ğŸ“¥ ØªØ³Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„...', 'info');
            
            // Clear existing module
            if (window.TitanModules && window.TitanModules.AIManagement) {
                delete window.TitanModules.AIManagement;
                addStatus('ğŸ”„ Ù…Ø§Ú˜ÙˆÙ„ Ù‚Ø¨Ù„ÛŒ Ù¾Ø§Ú© Ø´Ø¯', 'info');
            }
            
            // Remove existing script
            const existingScript = document.querySelector('script[src*="ai-management.js"]');
            if (existingScript) {
                existingScript.remove();
                addStatus('ğŸ”„ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ù‚Ø¨Ù„ÛŒ Ø­Ø°Ù Ø´Ø¯', 'info');
            }
            
            return new Promise((resolve, reject) => {
                const timestamp = Date.now();
                const script = document.createElement('script');
                script.src = `/static/modules/ai-management.js?v=${timestamp}`;
                
                script.onload = function() {
                    addStatus(`âœ… Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯ (${timestamp})`, 'success');
                    
                    if (window.TitanModules && window.TitanModules.AIManagement) {
                        addStatus('âœ… Ù…Ø§Ú˜ÙˆÙ„ AIManagement Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø§Ø³Øª', 'success');
                        addStatus(`ğŸ“‹ Ù†Ø³Ø®Ù‡ Ù…Ø§Ú˜ÙˆÙ„: ${window.TitanModules.AIManagement.version || 'Ù†Ø§Ù…Ø´Ø®Øµ'}`, 'info');
                        resolve();
                    } else {
                        addStatus('âŒ Ù…Ø§Ú˜ÙˆÙ„ AIManagement ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                        reject(new Error('Module not found'));
                    }
                };
                
                script.onerror = function() {
                    addStatus('âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª', 'error');
                    reject(new Error('Script loading failed'));
                };
                
                document.head.appendChild(script);
            });
        }
        
        async function testDashboardRender() {
            addStatus('ğŸ¨ ØªØ³Øª Ø±Ù†Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯...', 'info');
            
            try {
                // First load module if not already loaded
                if (!window.TitanModules || !window.TitanModules.AIManagement) {
                    await testModuleLoading();
                }
                
                const container = document.getElementById('ai-management-container');
                if (!container) {
                    addStatus('âŒ Ú©Ø§Ù†ØªÛŒÙ†Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯', 'error');
                    return;
                }
                
                // Clear container
                container.innerHTML = '<div class="text-center p-4"><i class="fas fa-spinner fa-spin mr-2"></i>Ø¯Ø± Ø­Ø§Ù„ Ø±Ù†Ø¯Ø±...</div>';
                
                // Render dashboard
                const dashboardHTML = window.TitanModules.AIManagement.render();
                container.innerHTML = dashboardHTML;
                addStatus('âœ… HTML Ø±Ù†Ø¯Ø± Ø´Ø¯', 'success');
                
                // Initialize module
                window.TitanModules.AIManagement.init();
                addStatus('âœ… Ù…Ø§Ú˜ÙˆÙ„ Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø´Ø¯', 'success');
                
                addStatus('ğŸ‰ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ù†Ø¯Ø± Ø´Ø¯!', 'success');
                
            } catch (error) {
                addStatus(`âŒ Ø®Ø·Ø§ Ø¯Ø± Ø±Ù†Ø¯Ø±: ${error.message}`, 'error');
                console.error('Dashboard render error:', error);
            }
        }
        
        // Auto-start debugging process
        document.addEventListener('DOMContentLoaded', async function() {
            addStatus('ğŸ”„ Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ Ø¯ÛŒØ¨Ø§Ú¯ Ø®ÙˆØ¯Ú©Ø§Ø±...', 'info');
            
            // Wait a moment for page to fully load
            setTimeout(async () => {
                await testAPIConnection();
                
                setTimeout(async () => {
                    try {
                        await testModuleLoading();
                        setTimeout(() => {
                            testDashboardRender();
                        }, 1000);
                    } catch (error) {
                        addStatus(`âŒ Ø¯ÛŒØ¨Ø§Ú¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ù†Ø§Ù…ÙˆÙÙ‚: ${error.message}`, 'error');
                    }
                }, 1000);
            }, 1000);
        });
        
        // Global error handler
        window.addEventListener('error', function(e) {
            addStatus(`ğŸš¨ JavaScript Error: ${e.message} Ø¯Ø± ${e.filename}:${e.lineno}`, 'error');
        });
    </script>
</body>
</html>