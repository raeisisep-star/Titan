<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุชุณุช ุงุณุชุฑุงุชฺโูุง</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-900 text-white p-6">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center">๐งช ุชุณุช ูุณุชูู ุงุณุชุฑุงุชฺโูุง</h1>
        
        <div class="bg-gray-800 rounded-lg p-6 mb-6 border border-gray-700">
            <h2 class="text-xl font-bold mb-4">ูุถุนุช ุจุงุฑฺฏุฑ ูุงฺูู:</h2>
            <div id="module-status" class="text-gray-400">ุฏุฑ ุญุงู ุจุฑุฑุณ...</div>
        </div>
        
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
            <button onclick="testCreateStrategy()" 
                    class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg transition-all">
                โจ ุชุณุช ุงุฌุงุฏ ุงุณุชุฑุงุชฺ
            </button>
            
            <button onclick="testEditStrategy()" 
                    class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg transition-all">
                โ๏ธ ุชุณุช ูุฑุงุด ุงุณุชุฑุงุชฺ
            </button>
            
            <button onclick="testBacktest()" 
                    class="bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-lg transition-all">
                ๐ฌ ุชุณุช ุจฺฉโุชุณุช
            </button>
            
            <button onclick="testOptimize()" 
                    class="bg-yellow-600 hover:bg-yellow-700 text-white p-4 rounded-lg transition-all">
                โ๏ธ ุชุณุช ุจูููโุณุงุฒ
            </button>
            
            <button onclick="testClone()" 
                    class="bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-lg transition-all">
                ๐ ุชุณุช ฺฉูพ ุงุณุชุฑุงุชฺ
            </button>
            
            <button onclick="testExport()" 
                    class="bg-red-600 hover:bg-red-700 text-white p-4 rounded-lg transition-all">
                ๐พ ุชุณุช ุตุงุฏุฑุงุช
            </button>
        </div>
        
        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <h2 class="text-xl font-bold mb-4">ูุงฺฏ ุนููุงุช:</h2>
            <div id="test-log" class="bg-gray-900 rounded p-4 h-64 overflow-y-auto font-mono text-sm">
                <div class="text-green-400">๐ข ุขูุงุฏู ุจุฑุง ุชุณุช...</div>
            </div>
        </div>
        
        <div class="text-center mt-6">
            <a href="/" class="text-blue-400 hover:text-blue-300 underline">
                ๐ ุจุงุฒฺฏุดุช ุจู ุณุณุชู ุชุงุชุงู
            </a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script>
        const log = document.getElementById('test-log');
        const status = document.getElementById('module-status');
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('fa-IR');
            const color = type === 'error' ? 'text-red-400' : 
                         type === 'success' ? 'text-green-400' : 
                         type === 'warning' ? 'text-yellow-400' : 'text-blue-400';
            
            log.innerHTML += `<div class="${color}">[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }
        
        // Load strategies module with fresh cache
        async function loadStrategiesModule() {
            try {
                addLog('๐ ุฏุฑ ุญุงู ุจุงุฑฺฏุฑ ูุงฺูู ุงุณุชุฑุงุชฺโูุง...');
                
                const script = document.createElement('script');
                script.src = `/static/modules/strategies-advanced.js?v=${Date.now()}`;
                
                return new Promise((resolve, reject) => {
                    script.onload = () => {
                        if (window.StrategiesAdvancedModule) {
                            window.strategiesAdvanced = new window.StrategiesAdvancedModule();
                            addLog('โ ูุงฺูู ุงุณุชุฑุงุชฺโูุง ุจุง ููููุช ุจุงุฑฺฏุฑ ุดุฏ', 'success');
                            status.innerHTML = '<span class="text-green-400">โ ูุงฺูู ุจุงุฑฺฏุฑ ุดุฏู</span>';
                            resolve();
                        } else {
                            addLog('โ ฺฉูุงุณ StrategiesAdvancedModule ุงูุช ูุดุฏ', 'error');
                            reject('Module class not found');
                        }
                    };
                    
                    script.onerror = () => {
                        addLog('โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฑ ูุงู ูุงฺูู', 'error');
                        reject('Script loading failed');
                    };
                    
                    document.head.appendChild(script);
                });
                
            } catch (error) {
                addLog(`โ ุฎุทุง: ${error.message}`, 'error');
                status.innerHTML = '<span class="text-red-400">โ ุฎุทุง ุฏุฑ ุจุงุฑฺฏุฑ</span>';
                throw error;
            }
        }
        
        // Test functions
        async function testCreateStrategy() {
            if (!window.strategiesAdvanced) {
                addLog('โ๏ธ ูุงฺูู ุจุงุฑฺฏุฑ ูุดุฏูุ ุฏุฑ ุญุงู ุจุงุฑฺฏุฑ...', 'warning');
                await loadStrategiesModule();
            }
            
            addLog('๐ ุชุณุช ุงุฌุงุฏ ุงุณุชุฑุงุชฺ ุฌุฏุฏ...');
            try {
                await window.strategiesAdvanced.createNewStrategy();
                addLog('โ ูุชุฏ createNewStrategy ูุฑุงุฎูุงู ุดุฏ', 'success');
            } catch (error) {
                addLog(`โ ุฎุทุง ุฏุฑ createNewStrategy: ${error.message}`, 'error');
            }
        }
        
        async function testEditStrategy() {
            if (!window.strategiesAdvanced) {
                await loadStrategiesModule();
            }
            
            addLog('๐ ุชุณุช ูุฑุงุด ุงุณุชุฑุงุชฺ...');
            try {
                await window.strategiesAdvanced.editStrategy('test-strategy-id');
                addLog('โ ูุชุฏ editStrategy ูุฑุงุฎูุงู ุดุฏ', 'success');
            } catch (error) {
                addLog(`โ ุฎุทุง ุฏุฑ editStrategy: ${error.message}`, 'error');
            }
        }
        
        async function testBacktest() {
            if (!window.strategiesAdvanced) {
                await loadStrategiesModule();
            }
            
            addLog('๐ ุชุณุช ุจฺฉโุชุณุช...');
            try {
                // First set a selected strategy
                window.strategiesAdvanced.selectedStrategyId = 'test-strategy';
                await window.strategiesAdvanced.runBacktest();
                addLog('โ ูุชุฏ runBacktest ูุฑุงุฎูุงู ุดุฏ', 'success');
            } catch (error) {
                addLog(`โ ุฎุทุง ุฏุฑ runBacktest: ${error.message}`, 'error');
            }
        }
        
        async function testOptimize() {
            if (!window.strategiesAdvanced) {
                await loadStrategiesModule();
            }
            
            addLog('๐ ุชุณุช ุจูููโุณุงุฒ...');
            try {
                window.strategiesAdvanced.selectedStrategyId = 'test-strategy';
                await window.strategiesAdvanced.optimizeStrategy();
                addLog('โ ูุชุฏ optimizeStrategy ูุฑุงุฎูุงู ุดุฏ', 'success');
            } catch (error) {
                addLog(`โ ุฎุทุง ุฏุฑ optimizeStrategy: ${error.message}`, 'error');
            }
        }
        
        async function testClone() {
            if (!window.strategiesAdvanced) {
                await loadStrategiesModule();
            }
            
            addLog('๐ ุชุณุช ฺฉูพ ุงุณุชุฑุงุชฺ...');
            try {
                window.strategiesAdvanced.selectedStrategyId = 'test-strategy';
                await window.strategiesAdvanced.cloneStrategy();
                addLog('โ ูุชุฏ cloneStrategy ูุฑุงุฎูุงู ุดุฏ', 'success');
            } catch (error) {
                addLog(`โ ุฎุทุง ุฏุฑ cloneStrategy: ${error.message}`, 'error');
            }
        }
        
        async function testExport() {
            if (!window.strategiesAdvanced) {
                await loadStrategiesModule();
            }
            
            addLog('๐ ุชุณุช ุตุงุฏุฑุงุช ุงุณุชุฑุงุชฺ...');
            try {
                window.strategiesAdvanced.selectedStrategyId = 'test-strategy';
                await window.strategiesAdvanced.exportStrategy();
                addLog('โ ูุชุฏ exportStrategy ูุฑุงุฎูุงู ุดุฏ', 'success');
            } catch (error) {
                addLog(`โ ุฎุทุง ุฏุฑ exportStrategy: ${error.message}`, 'error');
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            addLog('๐ข ุตูุญู ุชุณุช ุขูุงุฏู ุดุฏ');
            addLog('๐ก ูุทูุงู ุฏฺฉููโูุง ุชุณุช ุฑุง ูุดุงุฑ ุฏูุฏ');
        });
    </script>
</body>
</html>