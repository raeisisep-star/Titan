# Nginx Configuration Fix for JavaScript Module Caching Issue
# Add this to your nginx server block

location ~ \.js$ {
    # Disable caching for ALL JavaScript files to prevent module import issues
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;
    add_header Pragma "no-cache" always;
    add_header Expires "0" always;
    
    # Add ETag support for conditional requests (better than query params)
    etag on;
    
    # Disable If-Modified-Since to force fresh requests
    if_modified_since off;
    
    # Log for debugging
    access_log /var/log/nginx/titan-js-access.log;
}

location ~ \.css$ {
    # Similar for CSS files
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;
    add_header Pragma "no-cache" always;
    add_header Expires "0" always;
    etag on;
}

location = /index.html {
    # Never cache the main HTML file
    add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;
    add_header Pragma "no-cache" always;
    add_header Expires "0" always;
}

# To apply this configuration:
# 1. Copy this block into your nginx site config: /etc/nginx/sites-available/titan
# 2. Test configuration: sudo nginx -t
# 3. Reload nginx: sudo systemctl reload nginx
# 4. Users must hard-refresh (Ctrl+Shift+R) or clear browser cache after this change
