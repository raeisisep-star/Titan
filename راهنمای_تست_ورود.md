# 🔧 راهنمای تست سیستم ورود تایتان

## ✅ وضعیت سیستم

تمام تغییرات اعمال شده و سرور راه‌اندازی مجدد شده است:

- ✅ فایل `fix_login_button.js` ایجاد و در `index.html` اضافه شده
- ✅ فایل تست `test_login.html` برای عیب‌یابی ایجاد شده
- ✅ سرور PM2 راه‌اندازی مجدد شد
- ✅ تمام تغییرات در Git کامیت شده
- ✅ Nginx در حال سرویس‌دهی فایل‌های استاتیک است

## 🌐 آدرس دسترسی

**آدرس اصلی سیستم:**
```
http://188.40.209.82:80
```

**صفحه تست ورود:**
```
http://188.40.209.82:80/test_login.html
```

---

## 📋 مراحل تست (به ترتیب اولویت)

### ⭐ روش 1: تست مستقیم ورود

1. **پاک کردن کش مرورگر:**
   - فشار دادن `Ctrl + Shift + Delete`
   - انتخاب "Cached images and files"
   - کلیک روی "Clear data"

2. **بارگذاری مجدد سخت:**
   - فشار دادن `Ctrl + F5` (یا `Cmd + Shift + R` در Mac)

3. **باز کردن Console:**
   - فشار دادن `F12`
   - رفتن به تب "Console"

4. **تلاش برای ورود:**
   - وارد کردن نام کاربری: `admin`
   - وارد کردن رمز عبور: `admin123`
   - کلیک روی دکمه "ورود به سیستم"

5. **بررسی Console:**
   - باید پیام‌های زیر را ببینید:
   ```
   🔧 Applying login button fix...
   ✅ Login elements found, setting up handlers...
   ✅ Form submit listener attached
   ✅ Button click listener attached
   🎉 Login button fix applied successfully!
   ```

6. **اگر دکمه کار نکرد، در Console تایپ کنید:**
   ```javascript
   forceLogin()
   ```

---

### 🔍 روش 2: استفاده از صفحه تست (اگر روش 1 کار نکرد)

1. **باز کردن صفحه تست:**
   ```
   http://188.40.209.82:80/test_login.html
   ```

2. **اجرای دستورات تشخیصی به ترتیب:**
   
   در Console، دستورات زیر را یکی یکی کپی و اجرا کنید:

   ```javascript
   // 1. بررسی وجود عناصر
   console.log('Login Form:', document.getElementById('loginForm'));
   console.log('Login Button:', document.getElementById('loginBtn'));
   console.log('Username Input:', document.getElementById('username'));
   console.log('Password Input:', document.getElementById('password'));
   ```

   ```javascript
   // 2. بررسی Event Listeners
   const form = document.getElementById('loginForm');
   const btn = document.getElementById('loginBtn');
   console.log('Form has listeners:', getEventListeners(form));
   console.log('Button has listeners:', getEventListeners(btn));
   ```

   ```javascript
   // 3. تست submit دستی
   document.getElementById('username').value = 'admin';
   document.getElementById('password').value = 'admin123';
   document.getElementById('loginForm').submit();
   ```

   ```javascript
   // 4. تست با dispatchEvent
   document.getElementById('username').value = 'admin';
   document.getElementById('password').value = 'admin123';
   const event = new Event('submit', { bubbles: true, cancelable: true });
   document.getElementById('loginForm').dispatchEvent(event);
   ```

   ```javascript
   // 5. تست مستقیم handleLogin
   if (window.app) {
       document.getElementById('username').value = 'admin';
       document.getElementById('password').value = 'admin123';
       window.app.handleLogin({ preventDefault: () => {} });
   } else {
       console.error('window.app not found');
   }
   ```

   ```javascript
   // 6. تست با forceLogin
   document.getElementById('username').value = 'admin';
   document.getElementById('password').value = 'admin123';
   if (window.forceLogin) {
       window.forceLogin();
   } else {
       console.error('forceLogin not available');
   }
   ```

---

## 🐛 عیب‌یابی

### اگر هنوز دکمه ورود کار نکرد:

1. **بررسی خطاهای Console:**
   - آیا خطای قرمز رنگی وجود دارد؟
   - اسکرین‌شات بگیرید و ارسال کنید

2. **بررسی Network:**
   - رفتن به تب "Network" در Developer Tools
   - کلیک روی دکمه ورود
   - آیا درخواست `/api/auth/login` ارسال می‌شود؟
   - Status Code چیست؟ (باید 200 باشد)

3. **بررسی Response:**
   - در تب Network، روی `/api/auth/login` کلیک کنید
   - رفتن به تب "Response"
   - آیا `success: true` وجود دارد؟
   - آیا `token` برگشته؟

4. **تست مستقیم API با curl:**
   ```bash
   curl -X POST http://188.40.209.82:80/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin","password":"admin123"}'
   ```

---

## 📸 اطلاعات مورد نیاز برای عیب‌یابی

اگر مشکل همچنان ادامه دارد، لطفاً موارد زیر را ارسال کنید:

1. **اسکرین‌شات از Console** (F12 → Console)
2. **اسکرین‌شات از Network Tab** (درخواست login)
3. **نسخه مرورگر شما** (Chrome/Firefox/Safari + نسخه)
4. **نتیجه دستورات تشخیصی** (از صفحه test_login.html)

---

## 📝 تغییرات اعمال شده در این نسخه

### ✅ رفع مشکل دکمه ورود:

1. **فایل جدید: `fix_login_button.js`**
   - Event listener اضافی برای فرم و دکمه
   - سیستم fallback چند لایه:
     - تلاش اول: `window.app.handleLogin()`
     - تلاش دوم: `window.titanApp.handleLogin()`
     - تلاش سوم: ارسال مستقیم به `/api/auth/login`
   - تابع global `forceLogin()` برای تست دستی
   - لاگ‌های مفصل برای عیب‌یابی

2. **فایل تست: `test_login.html`**
   - صفحه تشخیصی کامل
   - دستورات Console آماده
   - راهنمای گام به گام

### ✅ رفع مشکل ذخیره تنظیمات صرافی‌ها:

- اضافه شدن `type="button"` به تمام دکمه‌ها (جلوگیری از refresh صفحه)
- پیاده‌سازی متد `saveSettings()` در `exchanges-tab.js`
- اضافه شدن endpoint‌های جدید در backend:
  - `GET /api/settings` - دریافت تنظیمات کاربر
  - `POST /api/settings/exchanges` - ذخیره تنظیمات صرافی‌ها
  - `POST /api/settings` - ذخیره کل تنظیمات
- ذخیره تنظیمات در PostgreSQL با فرمت JSONB

### ✅ پیاده‌سازی داده‌های واقعی:

- 4 endpoint جدید برای داده‌های بازار:
  - `GET /api/market/fear-greed` - شاخص ترس و طمع
  - `GET /api/market/top-movers` - بیشترین تغییرات
  - `GET /api/ai/signals` - سیگنال‌های معاملاتی
  - `GET /api/ai/recommendations` - توصیه‌های هوشمند

---

## 🎯 مراحل بعدی (در صورت موفقیت‌آمیز بودن ورود)

1. **تست تنظیمات صرافی MEXC:**
   - رفتن به منوی تنظیمات
   - انتخاب تب "صرافی‌ها"
   - ویرایش تنظیمات MEXC
   - کلیک روی "💾 ذخیره تنظیمات"
   - بررسی نوتیفیکیشن موفقیت
   - Refresh صفحه
   - بررسی ماندگاری تنظیمات

2. **تست باقی ویژگی‌ها:**
   - تست ویجت‌های داشبورد
   - بررسی داده‌های واقعی بازار
   - تست ویجت "به خاطر بسپار"

---

**تاریخ آخرین به‌روزرسانی:** 2025-10-16  
**نسخه:** 1.0.3  
**وضعیت سرور:** ✅ آنلاین و آماده
