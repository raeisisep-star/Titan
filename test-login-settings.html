<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test Login and Settings</title>
</head>
<body>
    <h1>Testing Login and Settings</h1>
    <div id="output"></div>
    
    <script>
        async function testLoginAndSettings() {
            const output = document.getElementById('output');
            
            function log(msg) {
                output.innerHTML += '<div>' + msg + '</div>';
                console.log(msg);
            }
            
            try {
                // Test login
                log('üîë Testing login...');
                const loginResponse = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'admin@titan.com',
                        password: 'admin123'
                    })
                });
                
                const loginData = await loginResponse.json();
                if (loginData.success) {
                    log('‚úÖ Login successful');
                } else {
                    log('‚ùå Login failed: ' + loginData.message);
                    return;
                }
                
                // Test settings.js loading
                log('üì± Testing settings.js loading...');
                const script = document.createElement('script');
                script.src = '/static/modules/settings.js?v=' + Date.now();
                
                script.onload = function() {
                    log('‚úÖ Settings.js loaded');
                    
                    if (window.SettingsModule) {
                        log('‚úÖ SettingsModule class found');
                        
                        try {
                            const settings = new window.SettingsModule();
                            log('‚úÖ SettingsModule instance created');
                            
                            // Test Trading tab
                            if (typeof settings.getTradingTab === 'function') {
                                log('‚úÖ getTradingTab method exists');
                                const tradingContent = settings.getTradingTab();
                                log('‚úÖ getTradingTab executed: ' + tradingContent.length + ' chars');
                            } else {
                                log('‚ùå getTradingTab method not found');
                            }
                            
                            // Test System tab
                            if (typeof settings.getSystemTab === 'function') {
                                log('‚úÖ getSystemTab method exists');
                                const systemContent = settings.getSystemTab();
                                log('‚úÖ getSystemTab executed: ' + systemContent.length + ' chars');
                            } else {
                                log('‚ùå getSystemTab method not found');
                            }
                            
                        } catch (e) {
                            log('‚ùå Error creating SettingsModule: ' + e.message);
                            log('   Stack: ' + e.stack);
                        }
                    } else {
                        log('‚ùå SettingsModule class not found');
                    }
                };
                
                script.onerror = function(e) {
                    log('‚ùå Failed to load settings.js: ' + e);
                };
                
                document.head.appendChild(script);
                
            } catch (error) {
                log('‚ùå Test failed: ' + error.message);
            }
        }
        
        // Add error handlers
        window.onerror = function(message, source, lineno, colno, error) {
            const output = document.getElementById('output');
            output.innerHTML += '<div style="color:red">‚ùå JS Error: ' + message + ' (Line: ' + lineno + ')</div>';
            return true;
        };
        
        // Start test
        testLoginAndSettings();
    </script>
</body>
</html>